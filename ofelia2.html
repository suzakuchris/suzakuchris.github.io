<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case File #8921-B: The Sorcerer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Special+Elite&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Cedarville+Cursive&family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">
    
    <style>
        /* --- Background: Dark Noir Slate (Cool Tone) --- */
        body {
            background-color: #0b0c10; /* Deep blue-black */
            background-image: url("assets/unnamed.jpg");
            font-family: 'Cormorant Garamond', serif;
            color: #1a1a1a;
            overflow-x: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* --- Layering System --- */
        .desk-layer {
            position: relative;
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: center;
            padding: 40px 0; 
        }

        /* Background Clutter (Cooler Tones) */
        .mess-item {
            position: absolute;
            box-shadow: 0 25px 50px rgba(0,0,0,0.8);
            border: 1px solid rgba(255,255,255,0.05);
            transition: transform 0.3s ease;
        }

        .folder-under {
            background-color: #4a5568; /* Slate Blue Folder */
            width: 90%;
            height: 95%;
            top: 10px;
            left: 10px;
            transform: rotate(-3deg);
            z-index: 1;
            border-radius: 4px;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.5);
        }
        
        .paper-under {
            background-color: #c5c6c7; /* Cool Grey Paper */
            background: url("assets/newspaper.jpg");
            width: 80%;
            height: 85%;
            top: 40px;
            right: -20px;
            transform: rotate(2deg);
            z-index: 2;
            padding: 20px;
        }

        /* --- Main Clipboard (Rusted Steel Look) --- */
        .clipboard-board {
            background-color: #1a1a1a;
            background-image: linear-gradient(to bottom right, #2d3748, #1a202c);
            box-shadow: 
                0 60px 100px -10px rgba(0,0,0,0.95),
                0 0 0 1px #4a5568;
            border-radius: 4px;
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 800px;
            transform: rotate(1deg);
        }

        /* --- Rusted Metal Clip --- */
        .metal-clip {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 60px;
            background: linear-gradient(180deg, #583e3e 0%, #3e2723 100%); /* Rusted hue */
            border-radius: 4px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.6);
            z-index: 50;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #3e2723;
        }
        .metal-clip::before { /* Rust texture */
            content: '';
            position: absolute;
            top:0; left:0; width:100%; height:100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.3'/%3E%3C/svg%3E");
            mix-blend-mode: overlay;
        }

        /* --- Archival Paper (Cool Grey/Silver) --- */
        .parchment {
            background-color: #e2e8f0; /* Cool Grey */
            background-image: 
                url("assets/paper.jpg");
            box-shadow: 
                inset 0 0 60px rgba(0,0,0,0.2),
                0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            padding-top: 80px;
            min-height: 950px;
            overflow: hidden; 
        }
        /* Paper texture overlay */
        .parchment::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='rough'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.05' numOctaves='2' result='noise'/%3E%3CfeDisplacementMap in='SourceGraphic' in2='noise' scale='10'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23rough)' opacity='0.1'/%3E%3C/svg%3E");
            opacity: 0.4;
            pointer-events: none;
            mix-blend-mode: multiply;
            z-index: 5;
        }

        /* --- Clutter Elements --- */
        
        /* Scotch Tape (Frosty) */
        .tape {
            background-color: rgba(255, 255, 255, 0.25);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            backdrop-filter: blur(2px); /* Frosty look */
            position: absolute;
            z-index: 20;
            opacity: 0.8;
            transform: rotate(-1deg);
        }
        .tape::after {
            content: '';
            position: absolute;
            left: 0; right: 0; top: 0; bottom: 0;
            background: repeating-linear-gradient(90deg, rgba(255,255,255,0.2) 0, rgba(255,255,255,0.2) 1px, transparent 1px, transparent 4px);
            opacity: 0.3;
        }

        /* Scrap Notes */
        .scrap-note {
            background-color: #f7fafc; /* Very light cool grey */
            box-shadow: 1px 3px 6px rgba(0,0,0,0.2);
            padding: 15px;
            position: relative;
            transform: rotate(-1deg);
            border: 1px solid #cbd5e0;
            margin-bottom: 20px;
            z-index: 25;
        }

        /* Header Bar (Laplace Style) */
        .header-bar {
            border-top: 3px solid #2d3748;
            border-bottom: 1px solid #2d3748;
            padding: 5px 0;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- Lighting Overlay (Cool Moon/Lab Light) --- */
        .lighting-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            /* Cool, sharp diagonal light */
            background: linear-gradient(125deg, 
                rgba(0,0,0,0.85) 0%, 
                rgba(0,0,0,0.7) 5%, 
                rgba(226, 232, 240, 0.15) 30%, /* The Beam */
                rgba(226, 232, 240, 0.05) 80%, 
                rgba(0,0,0,0.6) 95%, 
                rgba(0,0,0,0.9) 100%
            );
            pointer-events: none;
            z-index: 50;
            mix-blend-mode: hard-light;
        }

        /* --- Tabs (Tactical) --- */
        .side-tab {
            position: absolute;
            right: -32px;
            width: 35px;
            height: 80px;
            background: #2d3748;
            border-radius: 0 4px 4px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-family: 'Special Elite', monospace;
            font-size: 10px;
            cursor: pointer;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            border: 1px solid #1a202c;
            z-index: 5;
            transition: all 0.2s;
            color: #a0aec0;
            letter-spacing: 1px;
        }
        .side-tab.active {
            background: #e2e8f0;
            color: #1a202c;
            width: 40px;
            font-weight: bold;
        }

        /* Typography */
        .font-code { font-family: 'Libre Barcode 39 Text', cursive; font-size: 24px; }
        .font-typewriter { font-family: 'Special Elite', monospace; color: #2d3748; }
        .font-serif { font-family: 'Cormorant Garamond', serif; }

        /* Animations */
        .file-content { display: none; animation: fadeIn 0.4s ease-out; }
        .file-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Grunge Stamp Effect */
        .stamp-text {
            color: #8b0000;
            font-family: 'Special Elite', cursive;
            border: 3px double #8b0000;
            display: inline-block;
            padding: 2px 8px;
            transform: rotate(-5deg);
            opacity: 0.8;
            mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.5'/%3E%3C/svg%3E");
        }
        
        /* Typewriter List Items */
        .typewriter-item {
            border-bottom: 1px dotted #8d6e63;
            padding: 4px 0;
            margin-bottom: 4px;
            font-family: 'Special Elite', monospace;
            font-size: 11px;
            color: #1a1a1a;
            display: flex;
            justify-content: space-between;
            cursor: pointer;
            transition: background 0.2s;
        }
        .typewriter-item:hover {
            background-color: rgba(0,0,0,0.05);
        }
        .typewriter-item:last-child { border-bottom: none; }

        /* Skill Row */
        .skill-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #cbd5e0;
            padding: 2px 0;
            font-family: 'Special Elite', monospace;
            font-size: 11px;
            color: #2d3748;
            cursor: pointer;
        }
        .skill-row:hover { background-color: rgba(0,0,0,0.05); }
        .skill-row strong { color: #1a202c; }
        .skill-highlight {
            background-color: rgba(236, 201, 75, 0.15); /* Yellow Tint */
            border-left: 2px solid #d69e2e;
            padding-left: 4px;
        }

        /* Power Checkbox */
        .power-check {
            width: 12px;
            height: 12px;
            border: 1px solid #5d4037;
            display: inline-block;
            margin-right: 8px;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
        }
        .power-check:hover { background: rgba(0,0,0,0.1); }
    </style>
    <style>
        .power-iframe, .mitem-iframe {
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: #101010;
            width: 100%;
            height: 300px;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body onload="renderAllData()">

<div class="desk-layer">

    <!-- CLUTTER LAYER (Behind) -->
    <!-- 1. Slate Blue Folder -->
    <div class="mess-item folder-under flex flex-col justify-end p-4">
        <span class="font-typewriter text-lg text-white opacity-40 rotate-180 mb-4 ml-4">CONFIDENTIAL ARCHIVE</span>
    </div>
    
    <!-- 2. Light Grey Paper -->
    <div class="mess-item paper-under">
        <div class="w-full border-b border-gray-400 mb-4 opacity-50"></div>
        <p class="font-typewriter text-[10px] text-gray-600 opacity-60">
            [INTERCEPTED TRANSMISSION]<br>
            Source: Unidentified<br>
            "The magic flows differently here. It burns hotter than before."
        </p>
    </div>

    <!-- MAIN BOARD (The Focus) -->
    <main class="clipboard-board">
        
        <!-- Rusted Metal Clip -->
        <div class="metal-clip">
            <div class="w-24 h-px bg-white opacity-20"></div>
        </div>

        <!-- TABS -->
        <div style="top: 130px;" onclick="switchTab('profile')" id="tab-profile" class="side-tab active">BIO</div>
        <div style="top: 220px;" onclick="switchTab('vitals')" id="tab-vitals" class="side-tab">STAT</div>
        <div style="top: 310px;" onclick="switchTab('feats')" id="tab-feats" class="side-tab">FEAT</div>
        <div style="top: 400px;" onclick="switchTab('features')" id="tab-features" class="side-tab">POW</div>
        <div style="top: 490px;" onclick="switchTab('skills')" id="tab-skills" class="side-tab">SKIL</div>
        <div style="top: 580px;" onclick="switchTab('evidence')" id="tab-evidence" class="side-tab">ITEMS</div>

        <!-- MAIN PAPER -->
        <div class="parchment w-full h-full px-8 pb-12">
            
            <div class="lighting-overlay"></div>

            <!-- HEADER BAR (Scientific/Laplace Style) -->
            <div class="header-bar relative z-20">
                <div class="flex items-center gap-2">
                    <div class="w-6 h-6 border border-gray-600 flex items-center justify-center rounded-full">
                        <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
                    </div>
                    <div>
                        <h1 class="font-serif text-2xl font-bold text-gray-800 tracking-wide uppercase">File of Personnel</h1>
                        <p class="text-[8px] font-typewriter tracking-widest uppercase">Scientific Computing Center</p>
                    </div>
                </div>
                <div class="text-right whitespace-nowrap">
                    <p class="font-code">8921-B</p>
                    <p class="text-[9px] font-typewriter">CLR. LEVEL 5</p>
                </div>
            </div>

            <!-- CONTENT AREA -->
            <div class="relative z-20">

                <!-- === PROFILE TAB === -->
                <div id="content-profile" class="file-content active">
                    
                    <div class="block md:flex md:flex-col md:flex-row gap-6 mb-8 relative">
                        <!-- Photo (Clipped & Taped) -->
                        <div class="block md:flex w-full shrink-0 transform -rotate-2">
                            <div class="flex justify-center">
                                <div style="max-width:50vw;" class="bg-white p-2 m-2 shadow-md border border-gray-300">
                                    <img src="assets/Ofelia-old.png" alt="Suspect" class="w-full grayscale contrast-125 brightness-90">
                                </div>
                                <div class="tape w-20 h-8 -top-3 left-12"></div>
                            </div>
                            
                            <!-- Stat Block (Game Style) -->
                            <div style="background:#4e4a42;" class="w-full ml-4 mt-4 flex items-center bg-gray-800 text-gray-200 p-2 grid-cols-3 gap-4 text-xs font-typewriter shadow-lg transform rotate-1">
                                <div class="w-full bg-[#e8e0c5] shadow-[3px_3px_5px_rgba(0,0,0,0.2)] transform rotate-1 relative p-2">
                                    <!-- Inner dashed border -->
                                    <div class="border-2 border-dashed border-[#5d4037] p-2 h-full flex flex-col justify-between">
                                    <!-- Header -->
                                    <div class="text-center border-b-2 border-[#5d4037] pb-1 mb-2 relative">
                                        <span class="font-typewriter font-bold text-[#3e2723] text-xs tracking-[0.2em]">ATTRIBUTES</span>
                                    </div>
                                    <!-- Stats Grid -->
                                    <div class="grid grid-cols-3 gap-2">
                                        <!-- Stat Items -->
                                        <div class="flex flex-col items-center">
                                            <span class="font-serif italic font-bold text-[#6d4c41] text-[10px]">Str</span>
                                            <span id="val-str" class="font-typewriter text-xl font-bold text-[#1a1a1a] border-b border-[#a1887f] w-full text-center leading-none pb-1"></span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <span class="font-serif italic font-bold text-[#6d4c41] text-[10px]">Dex</span>
                                            <span id="val-dex" class="font-typewriter text-xl font-bold text-[#1a1a1a] border-b border-[#a1887f] w-full text-center leading-none pb-1"></span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <span class="font-serif italic font-bold text-[#6d4c41] text-[10px]">Con</span>
                                            <span id="val-con" class="font-typewriter text-xl font-bold text-[#1a1a1a] border-b border-[#a1887f] w-full text-center leading-none pb-1"></span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <span class="font-serif italic font-bold text-[#6d4c41] text-[10px]">Int</span>
                                            <span id="val-int" class="font-typewriter text-xl font-bold text-[#1a1a1a] border-b border-[#a1887f] w-full text-center leading-none pb-1"></span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <span class="font-serif italic font-bold text-[#6d4c41] text-[10px]">Wis</span>
                                            <span id="val-wis" class="font-typewriter text-xl font-bold text-[#1a1a1a] border-b border-[#a1887f] w-full text-center leading-none pb-1"></span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <span class="font-serif italic font-bold text-[#6d4c41] text-[10px]">Cha</span>
                                            <span id="val-cha" class="font-typewriter text-xl font-bold text-[#1a1a1a] border-b border-[#a1887f] w-full text-center leading-none pb-1"></span>
                                        </div>
                                    </div>
                                    </div>
                                    <!-- Tape -->
                                    <div class="tape w-12 h-8 -top-4 left-1/2 -translate-x-1/2 rotate-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <!-- Main Info Block -->
                        <div class="flex-1 space-y-4">
                            <!-- Info Card -->
                            <div class="bg-white/60 p-4 border-l-4 border-gray-700 shadow-sm relative">
                                <h2 class="font-serif text-3xl font-bold text-gray-900 mb-1">Ofelia von Moltke</h2>
                                <p class="font-typewriter text-xs text-gray-500 uppercase tracking-widest mb-4">Alias: The Drowned Knight</p>
                                
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm font-serif text-gray-800">
                                    <div>
                                        <span class="font-bold text-[10px] uppercase text-gray-500 block">Origin</span>
                                        Prussia
                                    </div>
                                    <div>
                                        <span class="font-bold text-[10px] uppercase text-gray-500 block">Race</span>
                                        Genasi
                                    </div>
                                    <div>
                                        <span class="font-bold text-[10px] uppercase text-gray-500 block">Class</span>
                                        Paladin/Bard
                                    </div>
                                    <div>
                                        <span class="font-bold text-[10px] uppercase text-gray-500 block">Apparition</span>
                                        Horror
                                    </div>
                                    <div>
                                        <span class="font-bold text-[10px] uppercase text-gray-500 block">Level</span>
                                        <span id="profile-level"></span>
                                    </div>
                                    <div>
                                        <span class="font-bold text-[10px] uppercase text-gray-500 block">Speed</span>
                                        5
                                    </div>
                                </div>
                            </div>

                            <!-- Note (Scrap) -->
                            <div class="scrap-note transform rotate-1">
                                <div class="tape w-8 h-10 -right-2 top-4 rotate-90"></div>
                                <p class="font-serif italic text-lg leading-relaxed text-gray-800">
                                    "She is cold to the touch. Her eyes seems dead with her hair as white as a snow. Her skin is pale, much like the winter of prussia."
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Stamp -->
                    <div class="absolute z-100 bottom-0 right-10 transform rotate-[-8deg] opacity-70 border-4 border-red-800 p-2 m-4 text-red-800 font-bold font-typewriter text-xl mask-image-grunge">
                        ARCANE THREAT
                    </div>

                </div>

                <div id="content-vitals" class="file-content">
                    
                    <!-- Tactical Assessment Card -->
                    <div class="tactical-card grid-bg w-full max-w-lg mx-auto mt-4 mb-8">
                        
                        <!-- Card Header -->
                        <div class="flex justify-between items-end border-b border-gray-600 pb-2 mb-4">
                            <div>
                                <h3 class="font-cinzel text-xl">Vital Statistics</h3>
                                <p class="text-[9px] font-typewriter text-gray-500 uppercase">Field Assessment Unit 4</p>
                            </div>
                            <div class="text-right">
                                <span class="text-green-500 text-xs font-mono animate-pulse">‚óè STABLE</span>
                            </div>
                        </div>

                        <!-- Grid Layout -->
                        <div class="grid grid-cols-2 gap-4">
                            
                            <!-- HP Box -->
                            <div class=" p-3 border border-gray-600 relative overflow-hidden group">
                                <span class="block text-[10px] font-typewriter text-gray-500 uppercase mb-1">Health Points</span>
                                <div class="flex items-baseline gap-2">
                                    <span id="stat-hp-curr" class="font-cinzel text-3xl">38</span>
                                    <span id="stat-hp-max" class="text-gray-500 text-sm">/ 38</span>
                                </div>
                                <!-- HP Bar Aesthetic -->
                                <div class="w-full h-1 bg-gray-700 mt-2">
                                    <div class="w-full h-full bg-red-800/80"></div>
                                </div>
                            </div>

                            <!-- Surges Box -->
                            <div class=" p-3 border border-gray-600">
                                <span class="block text-[10px] font-typewriter text-gray-500 uppercase mb-1">Healing Surges</span>
                                <div class="flex justify-between items-center h-full pb-2">
                                    <span class="font-cinzel text-3xl ">8/8</span>
                                    <!-- Decorative notches -->
                                    <div class="flex gap-1">
                                        <div class="w-2 h-4 bg-gray-400"></div>
                                        <div class="w-2 h-4 bg-gray-400"></div>
                                        <div class="w-2 h-4 bg-gray-400"></div>
                                        <div class="w-2 h-4 bg-gray-400"></div>
                                        <div class="w-2 h-4 bg-gray-400"></div>
                                        <div class="w-2 h-4 bg-gray-400"></div>
                                        <div class="w-2 h-4 bg-gray-400"></div>
                                        <div class="w-2 h-4 bg-gray-400"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Initiative -->
                            <div class=" p-3 border border-gray-600">
                                <span class="block text-[10px] font-typewriter text-gray-500 uppercase mb-1">Initiative</span>
                                <span id="stat-init" class="font-cinzel text-2xl"></span>
                            </div>

                            <!-- Passive Perception -->
                            <div class=" p-3 border border-gray-600">
                                <span class="block text-[10px] font-typewriter text-gray-500 uppercase mb-1">P. Perception</span>
                                <span id="stat-pperception" class="font-cinzel text-2xl"></span>
                            </div>

                            <!-- Attack Roll (Full Width) -->
                            <div class="col-span-2  p-3 border border-gray-600">
                                <span class="block text-[10px] font-typewriter text-gray-500 uppercase mb-2">Offensive Capabilities</span>
                                <div id="dmg-bonuses-list" class="flex flex-col gap-1 text-xs font-typewriter text-gray-800">
                                    <!-- Populated by JS -->
                                </div>
                            </div>

                            <!-- Defenses (Full Width) -->
                            <div class="col-span-2  p-3 border border-gray-600">
                                <span class="block text-[10px] font-typewriter text-gray-500 uppercase mb-2">Defensive Metrics</span>
                                <div class="grid grid-cols-4 gap-2 text-center">
                                    <div>
                                        <span class="text-gray-500 block">AC</span>
                                        <span id="stat-ac" class="font-cinzel text-xl"></span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500 block">FORT</span>
                                        <span id="stat-fort" class="font-cinzel text-xl"></span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500 block">REF</span>
                                        <span id="stat-ref" class="font-cinzel text-xl"></span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500 block">WILL</span>
                                        <span id="stat-will" class="font-cinzel text-xl"></span>
                                    </div>
                                </div>
                            </div>

                        </div>
                        
                        <!-- Footer code -->
                        <div class="mt-4 pt-2 border-t border-gray-600 flex justify-between">
                            <span class="font-barcode text-xl text-gray-500">8921-B</span>
                            <span class="font-typewriter text-[8px] text-gray-600">CONFIDENTIAL</span>
                        </div>
                    </div>
                </div>

                <div id="content-skills" class="file-content">
                    
                    <div class="bg-white p-6 shadow-md transform rotate-1 border border-gray-300 relative max-w-lg mx-auto mt-4">
                        <div class="tape w-28 h-8 -top-4 left-1/2 -translate-x-1/2 rotate-[-1deg]"></div>
                        
                        <div class="text-center mb-6">
                            <h3 class="font-typewriter text-2xl font-bold text-gray-800 border-b-2 border-gray-800 inline-block pb-1">COMPETENCY EVALUATION</h3>
                            <p class="text-[10px] text-gray-500 mt-1 uppercase tracking-widest">Field Agent Proficiency Assessment Form 104-B</p>
                        </div>

                        <!-- Dynamic Skills Grid -->
                        <div id="skills-list" class="grid grid-cols-2 gap-x-8 gap-y-1">
                            <!-- Populated by JS -->
                        </div>

                        <div class="mt-8 flex justify-between items-end">
                            <div class="text-[10px] font-typewriter text-gray-400">
                                EVALUATOR: <span class="font-handwriting text-lg text-blue-900">Dr. Arkwright</span>
                            </div>
                            <div class="w-16 h-16 rounded-full border-4 border-blue-900 flex items-center justify-center opacity-40 transform rotate-[-12deg]">
                                <span class="text-blue-900 font-bold text-xs text-center leading-none">CLEARED<br>FOR<br>DUTY</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Shared Iframe for Skills -->
                    <div class="space-y-1 mt-3">
                         <p class="text-[10px] text-gray-500 font-typewriter mb-1">> ACCESSING DATABASE...</p>
                        <iframe id="iframe-skills" class="power-iframe" src="about:blank" frameborder="0"></iframe>
                    </div>
                </div>

                <!-- === TAB 4: FEATS === -->
                <div id="content-feats" class="file-content">
                    
                    <div class="flex flex-col gap-8 mt-2">
                        <div class="w-full bg-[#fcfbf9] shadow-[0_4px_6px_rgba(0,0,0,0.1)] p-6 relative mt-4 transform rotate-[0.5deg]">
                            <div class="tape w-32 h-8 -top-4 left-1/2 -translate-x-1/2 rotate-1"></div>
                            
                            <div class="flex justify-between items-start border-b-2 border-gray-800 pb-2 mb-6">
                                <div>
                                    <h3 class="font-typewriter font-bold text-2xl text-gray-900">GENERAL TACTICS</h3>
                                    <p class="text-[9px] font-sans text-gray-500 uppercase">Authorization Code: OMEGA-7</p>
                                </div>
                                <div class="border-2 border-red-800 px-2 py-1 transform rotate-[-5deg]">
                                    <span class="font-typewriter text-red-800 font-bold text-xs">LETHAL FORCE<br>AUTHORIZED</span>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                
                                <!-- AT-WILL -->
                                <div class="col-span-1 md:col-span-2">
                                    <h4 class="font-cinzel text-lg text-gray-800 border-b border-gray-400 mb-2">Standard Engagement (At-Will)</h4>
                                    <div id="powers-atwill" class="grid grid-cols-2 gap-4">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>

                                <!-- ENCOUNTER -->
                                <div>
                                    <h4 class="font-cinzel text-lg text-gray-800 border-b border-gray-400 mb-2">Tactical Options (Encounter)</h4>
                                    <ul id="powers-encounter" class="space-y-2 font-typewriter text-sm text-gray-700">
                                        <!-- Populated by JS -->
                                    </ul>
                                </div>

                                <!-- DAILY -->
                                <div>
                                    <h4 class="font-cinzel text-lg text-gray-800 border-b border-gray-400 mb-2">Restricted (Daily)</h4>
                                    <ul id="powers-daily" class="space-y-2 font-typewriter text-sm text-gray-700">
                                        <!-- Populated by JS -->
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- FEATS CARD -->
                        <div class="w-full bg-[#e8e0c5] shadow-[2px_4px_8px_rgba(0,0,0,0.3)] transform -rotate-1 relative p-2">
                            <div class="border border-[#5d4037] p-4">
                                <div class="tape w-20 h-6 -top-5 left-10 rotate-[-2deg]"></div>
                                <div class="border-b border-[#5d4037] mb-3 pb-1 flex justify-between items-end">
                                    <h3 class="font-typewriter font-bold text-lg text-[#3e2723] tracking-widest">EXHIBITED TRAITS (FEATS)</h3>
                                    <span class="text-[9px] font-serif italic text-[#5d4037]">Section 3-A</span>
                                </div>
                                <div id="feats-list" class="space-y-1">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>

                        <!-- Shared Iframe for Feats -->
                        <div class="space-y-1 mt-3">
                             <p class="text-[10px] text-gray-500 font-typewriter mb-1">> ACCESSING DATABASE...</p>
                            <iframe id="iframe-feats" class="power-iframe" src="about:blank" frameborder="0"></iframe>
                        </div>
                    </div>
                </div>

                <!-- === TAB 5: POWERS === -->
                <div id="content-features" class="file-content">
                    <!-- FEATURES CARD -->
                    <div class="w-full bg-[#f2f2f2] shadow-[2px_4px_8px_rgba(0,0,0,0.2)] transform rotate-1 relative p-2 border border-gray-300">
                        <div class="tape w-20 h-6 -top-5 right-10 rotate-[3deg]"></div>
                        <div class="p-3">
                            <h3 class="font-serif font-bold text-xl text-gray-800 border-b border-gray-400 mb-3">INHERENT TRAITS</h3>
                            <div id="features-list" class="font-serif text-sm text-gray-800 space-y-4">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- === EVIDENCE (ITEMS) TAB === -->
                <div id="content-evidence" class="file-content">
                    
                    <div class="grid grid-cols-1 gap-6">
                        <!-- Header -->
                        <div class="bg-gray-800 text-gray-200 p-2 font-typewriter text-center border border-gray-600">
                            INVENTORY MANIFEST
                        </div>

                        <div id="items-list" class="space-y-4">
                             <!-- Populated by JS -->
                        </div>

                        <!-- Shared Iframe for Items -->
                        <div class="space-y-1 mt-3">
                             <p class="text-[10px] text-gray-500 font-typewriter mb-1">> ACCESSING DATABASE...</p>
                            <iframe id="iframe-evidence" class="power-iframe" src="about:blank" frameborder="0"></iframe>
                        </div>
                    </div>

                </div>

            </div>

        </div>
    </main>
</div>

<script>
    // =========================================================================
    //  EDITABLE DATA: Modify these objects to update your character sheet
    // =========================================================================
    const level = 2;
    const weaponProf = 3;
    const otherBonus = 2; //expertise and magic weapon
    const levelBonus = Math.floor(level/2);
    const ACBonus = 1+2+8;//veterans armor (cloth), shield
    const REFBonus = 1+1+2; //rhythm dagger and safewing amulet
    const FORTBonus = 1+1; //safewing amulet
    const WILLBonus = 1; //safewing amulet
    const HSUsed = 0;

    const attributes = {
        "STR": 10, "CON": 10, "DEX": 8, "INT": 18, "WIS": 10, "CHA": 20
    };

    //skill versatility: untrained = +1bonus
    const skills = {
        "Acrobatics": { id: 'skill1', baseAttribute: "DEX", trained: false, otherBonus: 1 },
        "Arcana": { id: 'skill2', baseAttribute: "INT", trained: false, otherBonus: 1 },
        "Athletics": { id: 'skill27', baseAttribute: "STR", trained: false, otherBonus: 1 },
        "Bluff": { id: 'skill3', baseAttribute: "CHA", trained: true, otherBonus: 0 },
        "Diplomacy": { id: 'skill6', baseAttribute: "CHA", trained: true, otherBonus: 0 },
        "Dungeoneering": { id: 'skill7', baseAttribute: "WIS", trained: false, otherBonus: 1 },
        "Endurance": { id: 'skill8', baseAttribute: "CON", trained: false, otherBonus: 1+2 },
        "Heal": { id: 'skill9', baseAttribute: "WIS", trained: false, otherBonus: 1 },
        "History": { id: 'skill11', baseAttribute: "INT", trained: true, otherBonus: 0 },
        "Insight": { id: 'skill13', baseAttribute: "WIS", trained: false, otherBonus: 1 },
        "Intimidate": { id: 'skill14', baseAttribute: "CHA", trained: true, otherBonus: 0 },
        "Nature": { id: 'skill16', baseAttribute: "WIS", trained: false, otherBonus: 1+2 },
        "Perception": { id: 'skill17', baseAttribute: "WIS", trained: false, otherBonus: 1 },
        "Religion": { id: 'skill18', baseAttribute: "INT", trained: false, otherBonus: 1 },
        "Stealth": { id: 'skill20', baseAttribute: "DEX", trained: false, otherBonus: 1 },
        "Streetwise": { id: 'skill21', baseAttribute: "CHA", trained: true, otherBonus: 0 },
        "Thievery": { id: 'skill23', baseAttribute: "DEX", trained: false, otherBonus: 1 }
    };

    const powersToDisplay = [
        { id: 'power7241', name: 'Ardent Strike', type: 'At-Will' },
        { id: 'power14449', name: 'Song of Serendipity', type: 'At-Will' },

        { id: 'power15849', name: 'Skald\'s Aura', type: 'Encounter' },
        { id: 'power13815', name: 'Dread Smite', type: 'Encounter' },
        { id: 'power1770', name: 'Swiftcurrent', type: 'Encounter' },

        // { id: 'custom_power/grimoire', name: 'Grimoire\'s Shield', type: 'Daily' },
        { id: 'power14456', name: 'Disruptive Words', type: 'Daily' },
    ];

    const featsToDisplay = [
        { id: 'feat3741', name: 'Devout Protector Expertise' },
        { id: 'feat1366', name: 'Hybrid Talent (Paladin Armor Proficiency)' },
        { id: 'feat3668', name: 'Skald\'s Training' },
    ];

    const magicItems = [
        { id: 'armor2986', name: 'Veterans Armor (+1)' },
        { id: 'item498', name: 'Amulet of Protection (+1)' },
        { id: 'weapon1782', name: 'Magic Weapon (+1)' },
    ];

    const bonusDamageReminder = [
    ];

    const miscFeaturesToDisplay = [
        { name: 'Genasi Traits', content: `
            Size: Medium
            Speed: 6 squares.
            Vision: Normal

            Languages: Common, Primordial
            Skill Bonuses: +2 Endurance, +2 Nature.
            Elemental Manifestation: Watersoul: You can breathe underwater. You also gain a +2 racial bonus to saving throws against ongoing damage and the swiftcurrent power.
            Elemental Origins: Your ancestors were native to the Elemental Chaos, so you are considered an elemental creature for the purpose of effects that relate to creature origin.
        ` },
        { name: 'Blackguard Paladin (Bard/Paladin)', content: `
            Armor Proficiencies:Cloth, leather, hide, chainmail, scale, plate; heavy shields, light shields.
            Weapon Proficiencies:Simple melee, military melee, simple ranged, military ranged.
            Implement:Holy symbols, wands
            Bonus to Defense:+2 Ref

            Hit Points at 1st Level: 7.5 + 6 + Constitution Score.
            Hit Points per Level Gained: 3 + 2.5
            Healing Surges per Day: 5 + 3.5

            SKILL VERSATILITY
            You gain a +1 bonus to untrained skill checks.

            BARD HYBRID
            Extra 1 skill trained.

            DARK MENACE (HYBRID)
            Whenever you make a weapon attack against an enemy granting combat advantage to you using a paladin power or paladin paragon path power, that enemy takes extra damage equal to your Charisma modifier.

            DREAD SMITE (HYBRID)
            You can select the dread smite power whenever you have the opportunity to gain or replace a class encounter attack power that has a level. If you already have dread smite, you gain an additional use of the power if you select it again.

            SPIRIT OF VICE (HYBRID)
            You choose a vice and gain the benefit of the Spirit of Vice class feature, except that the benefit applies only to your paladin powers and paladin paragon path powers.
            
            Spirit of Vice (Fury)
            While you have combat advantage against an enemy, you gain a +2 bonus to damage rolls. The bonus increases to +4 while you are bloodied or adjacent to a bloodied creature.
        ` },
    ];

    // =========================================================================
    //  LOGIC & RENDERING
    // =========================================================================

    // Helper: Calculate Modifier (Score - 10) / 2
    function getMod(score) {
        return Math.floor((score - 10) / 2);
    }

    // Helper: Update Iframe
    function showCompendium(id) {
        if (!id) return;
        const url = `https://iws.mx/dnd/?view=${id}`;
        // Update all iframes to ensure the active tab shows it
        document.querySelectorAll('.power-iframe').forEach(iframe => {
            iframe.src = url;
        });
    }

    function renderAllData() {
        // --- 1. Bio / Attributes ---
        document.getElementById('val-str').innerText = attributes.STR;
        document.getElementById('val-dex').innerText = attributes.DEX;
        document.getElementById('val-con').innerText = attributes.CON;
        document.getElementById('val-int').innerText = attributes.INT;
        document.getElementById('val-wis').innerText = attributes.WIS;
        document.getElementById('val-cha').innerText = attributes.CHA;
        document.getElementById('profile-level').innerText = level;

        // --- 2. Vitals & Defenses ---
        const strMod = getMod(attributes.STR);
        const conMod = getMod(attributes.CON);
        const dexMod = getMod(attributes.DEX);
        const intMod = getMod(attributes.INT);
        const wisMod = getMod(attributes.WIS);
        const chaMod = getMod(attributes.CHA);

        // Initiative: Dex Mod + Level Bonus
        const init = intMod + levelBonus + 1; 
        document.getElementById('stat-init').innerText = (init >= 0 ? "+" : "") + init;

        // Passive Perception: 10 + Skill Total
        const perceptionSkill = skills["Perception"];
        const pPerception = 10 + levelBonus + getMod(attributes[perceptionSkill.baseAttribute]) + (perceptionSkill.trained ? 5 : 0) + perceptionSkill.otherBonus;
        document.getElementById('stat-pperception').innerText = pPerception;

        // Defenses: 10 + Half Level + Ability Mod + Class/Feat Bonuses
        // AC: Uses Dex or Int (or Str due to Dragon Sorcerer feat/feature if applicable, but standard is Dex/Int. 
        // Note: The prompt implies Sorcerer might use Str for AC via Draconic Resilience).
        // Draconic Resilience: "use Strength modifier in place of Dex/Int".
        const acBaseMod = 0
        const ac = 10 + levelBonus + acBaseMod + ACBonus;

        const fortBaseMod = Math.max(strMod, conMod);
        const fort = 10 + levelBonus + fortBaseMod + FORTBonus;

        const refBaseMod = Math.max(dexMod, intMod);
        const ref = 10 + levelBonus + refBaseMod + REFBonus;

        const willBaseMod = Math.max(wisMod, chaMod);
        const will = 10 + levelBonus + willBaseMod + WILLBonus;

        document.getElementById('stat-ac').innerText = ac;
        document.getElementById('stat-fort').innerText = fort;
        document.getElementById('stat-ref').innerText = ref;
        document.getElementById('stat-will').innerText = will;

        // Damage Bonus List
        const bonusListEl = document.getElementById('dmg-bonuses-list');
        bonusListEl.innerHTML = '';
        bonusDamageReminder.forEach(b => {
            const row = document.createElement('div');
            row.innerHTML = `<span class="font-bold">+${b.plus}</span> <span>${b.notes}</span>`;
            bonusListEl.appendChild(row);
        });

        // --- 3. Skills ---
        const skillsContainer = document.getElementById('skills-list');
        skillsContainer.innerHTML = '';
        
        for (const [name, data] of Object.entries(skills)) {
            const attrMod = getMod(attributes[data.baseAttribute]);
            const trainedBonus = data.trained ? 5 : 0;
            const total = levelBonus + attrMod + trainedBonus + data.otherBonus;
            
            const row = document.createElement('div');
            // Highlight trained skills
            row.className = `skill-row ${data.trained ? 'skill-highlight' : ''}`;
            
            // On Click
            if (data.id) {
                row.onclick = () => showCompendium(data.id);
            }

            row.innerHTML = `
                <span>${name} <span class="text-[9px] text-gray-400">(${data.baseAttribute})</span></span>
                <strong>${total >= 0 ? '+' : ''}${total}</strong>
            `;
            skillsContainer.appendChild(row);
        }

        // --- 4. Powers ---
        const atWillContainer = document.getElementById('powers-atwill');
        const encounterContainer = document.getElementById('powers-encounter');
        const dailyContainer = document.getElementById('powers-daily');

        atWillContainer.innerHTML = '';
        encounterContainer.innerHTML = '';
        dailyContainer.innerHTML = '';

        powersToDisplay.forEach(p => {
            if (p.type === 'At-Will') {
                const el = document.createElement('div');
                el.className = "bg-gray-100 p-2 border-l-4 border-green-700 cursor-pointer hover:bg-gray-200 transition";
                el.innerHTML = `<span class="font-serif font-bold text-sm">${p.name}</span>`;
                if(p.id) el.onclick = () => showCompendium(p.id);
                atWillContainer.appendChild(el);
            } else if (p.type === 'Encounter') {
                const el = document.createElement('li');
                el.className = "flex items-center cursor-pointer hover:text-red-800";
                el.innerHTML = `<div class="power-check"></div> ${p.name}`;
                if(p.id) el.onclick = () => showCompendium(p.id);
                encounterContainer.appendChild(el);
            } else if (p.type === 'Daily') {
                const el = document.createElement('li');
                el.className = "flex items-center cursor-pointer hover:text-red-800";
                el.innerHTML = `<div class="power-check"></div> ${p.name}`;
                if(p.id) el.onclick = () => showCompendium(p.id);
                dailyContainer.appendChild(el);
            }
        });

        // --- 5. Feats ---
        const featsContainer = document.getElementById('feats-list');
        featsContainer.innerHTML = '';
        featsToDisplay.forEach(f => {
            const el = document.createElement('div');
            el.className = "typewriter-item";
            el.innerHTML = `<span>${f.name}</span> <span class="text-[9px]">[FEAT]</span>`;
            if(f.id) el.onclick = () => showCompendium(f.id);
            featsContainer.appendChild(el);
        });

        // --- 6. Features (Misc) ---
        const featuresContainer = document.getElementById('features-list');
        featuresContainer.innerHTML = '';
        miscFeaturesToDisplay.forEach(f => {
             const el = document.createElement('div');
             // Format content with line breaks
             const contentHtml = f.content.replace(/\n/g, '<br>');
             el.innerHTML = `
                <strong class="block text-gray-900 border-b border-gray-400 mb-1">${f.name}</strong>
                <p class="text-xs leading-relaxed pl-2 border-l-2 border-gray-300">${contentHtml}</p>
             `;
             featuresContainer.appendChild(el);
        });

        // --- 7. Items ---
        const itemsContainer = document.getElementById('items-list');
        itemsContainer.innerHTML = '';
        magicItems.forEach(item => {
            const el = document.createElement('div');
            el.className = "relative bg-transparent border-b border-dashed border-gray-400 p-2 cursor-pointer hover:bg-black/5";
            el.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="font-serif font-bold text-gray-800">${item.name}</span>
                    <span class="font-typewriter text-[9px] text-gray-500">${item.id || 'N/A'}</span>
                </div>
            `;
            if(item.id) el.onclick = () => showCompendium(item.id);
            itemsContainer.appendChild(el);
        });
    }

    // === TAB LOGIC ===
    function switchTab(tabId) {
        document.querySelectorAll('.side-tab').forEach(tab => {
            tab.classList.remove('active');
            tab.style.backgroundColor = '#2d3748';
            tab.style.color = '#a0aec0';
        });
        const activeTab = document.getElementById(`tab-${tabId}`);
        activeTab.classList.add('active');
        activeTab.style.backgroundColor = '#e2e8f0';
        activeTab.style.color = '#1a202c';

        document.querySelectorAll('.file-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`content-${tabId}`).classList.add('active');
    }
</script>

</body>
</html>