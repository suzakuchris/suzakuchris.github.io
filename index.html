<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RISE - Anneliese Highwind</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet">
    <style>
        body {
            /* Dark, aged paper background color */
            background-color: #0e0e0e;
            font-family: 'EB Garamond', serif;
            min-height: 100vh;
        }
        .tome-font {
            font-family: 'Uncial Antiqua', cursive;
        }
        .tome-item {
            /* Rigid, non-rotated style with subtle border */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border: 1px solid rgba(255,255,255,0.1);
            height: 100%;
        }
        .tome-item:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 15px -3px rgba(255, 255, 255, 0.1), 0 4px 6px -2px rgba(255, 255, 255, 0.05);
        }
        .bg-dark-subtle {
            background-color: #1a1a1a !important;
        }
        .bg-dark-deep {
            background-color: #121212 !important;
        }

        /* CSS for the randomly positioned decorative images */
        .grimoire-decoration {
            position: absolute;
            z-index: 1; /* Below the main content */
            width: 120px;
            height: auto;
            opacity: 0.2;
        }

        .grimoire-decoration:hover {
            opacity: 0.5;
        }

        /* Positioning for each decorative image */
        .grimoire-deco-1 { top: 5%; left: 5%; transform: rotate(-10deg); }
        .grimoire-deco-2 { top: 15%; right: 8%; transform: rotate(15deg); }
        .grimoire-deco-3 { bottom: 10%; left: 12%; transform: rotate(5deg); }
        .grimoire-deco-4 { bottom: 5%; right: 5%; transform: rotate(-20deg); }
        .grimoire-deco-5 { bottom: 85%; right: 75%; transform: rotate(20deg); }
        .grimoire-deco-6 { bottom: 30%; right: 25%; transform: rotate(-70deg); }

        .power-item-container,
        .feat-item-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .skill-name-link,
        .power-name-link,
        .feat-name-link,
        .misc-feature-link {
            flex-grow: 1;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .skill-name-link:hover,
        .power-name-link:hover,
        .feat-name-link:hover,
        .misc-feature-link:hover {
            text-decoration: underline;
        }
        
        .btn-clear-all {
            background-color: #6e7f80;
            color: #fff;
            border: 1px solid #6e7f80;
            transition: background-color 0.3s;
        }
        .btn-clear-all:hover {
            background-color: #708090;
            color: #fff;
            border-color: #708090;
        }

        /* Iframe for displaying power details */
        .power-iframe, .mitem-iframe {
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: #101010;
            width: 100%;
            height: 300px;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }

        /* Custom styles for the HP inputs and bloodied animation */
        .hp-input-container {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .hp-input-container input {
            background-color: #101010;
            border: 1px solid #6e7f80;
            color: #fff;
            font-size: 1.25rem;
            width: 50px;
            text-align: center;
            padding: 0.25rem;
        }
        .hp-input-container input:focus {
            background-color: #708090;
            border-color: #fff;
        }
        .bloodied-effect {
            box-shadow: 0 0 10px 5px rgba(255, 0, 0, 0.5);
            animation: pulse-red 1.5s infinite alternate;
        }
        @keyframes pulse-red {
            from { box-shadow: 0 0 10px 5px rgba(255, 0, 0, 0.5); }
            to { box-shadow: 0 0 15px 8px rgba(255, 0, 0, 0.8); }
        }

        /* Custom styles for the healing surge slider */
        .surge-slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            width: 100%;
        }
        .surge-slider-container input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: #6e7f80;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 3px;
        }
        .surge-slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #fff;
            cursor: pointer;
            border-radius: 50%;
        }

        /* Fixing the image stretching in sketches & records */
        .sketches img {
            width: 100%;
            height: auto;
            object-fit: cover;
            aspect-ratio: 4 / 3;
        }
        .portrait-container img {
            width: 100%;
            height: auto;
            /* aspect-ratio: 1 / 1; */
            object-fit: cover;
        }

        /* Power list grid layout */
        .power-grid {
            display: grid;
            gap: 0.5rem;
            grid-template-columns: repeat(2, 1fr);
        }

        /* Mobile nav styling */
        .mobile-nav {
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1030; /* Higher than other fixed elements */
            background-color: rgba(14, 14, 14, 0.95);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .mobile-nav a {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 0.8rem;
            padding: 0.5rem 0.25rem;
            color: #ccc;
        }
        .mobile-nav a:hover, .mobile-nav a.active {
            color: #fff;
            background-color: transparent;
            text-decoration: underline;
        }

        /* Extra padding for the main container on mobile to prevent content from being hidden behind the nav bar */
        @media (max-width: 991px) {
            .tome-container {
                padding-top: 5rem !important;
            }
        }
        /* Single column on small screens */
        @media (max-width: 767px) {
            .power-grid {
                grid-template-columns: 1fr;
            }
        }

        #roleplay-page{
            display:none;
        }

        .show-roleplay #roleplay-page{
            display:flex;
        }

        #combat-page{
            max-width:100%;
            transition: 0.6s;
        }

        .show-roleplay #combat-page{
            max-width:0%;
            padding:0px;
            overflow:hidden;
        }

        .show-roleplay #combat-page .row{
            display:none;
        }

        #misc-feature-content{
            white-space: pre-line;
        }
        
        #notes-area, #inventory-area {
            min-height: 250px;
        }

        .nav-tabs .nav-link.active {
            background-color: #1a1a1a !important;
            border-color: #1a1a1a #1a1a1a #121212 !important;
            color: #fff !important;
        }

        .nav-tabs {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tabs .nav-link {
            color: #ccc;
            border-color: transparent;
        }

        .nav-tabs .nav-link:hover {
            color: #fff;
        }

    </style>
</head>
<body class="text-white" id="mode">
    <img src="https://suzakuchris.github.io/assets/lahabrea.png" alt="A decorative symbol" class="grimoire-decoration grimoire-deco-1 d-none d-lg-block">
    <img src="https://suzakuchris.github.io/assets/ascian.png" alt="A decorative symbol" class="grimoire-decoration grimoire-deco-6 d-none d-lg-block">
    <img src="https://suzakuchris.github.io/assets/lahabrea.png" alt="A decorative seal" class="grimoire-decoration grimoire-deco-2 d-none d-lg-block">
    <img src="https://suzakuchris.github.io/assets/lahabrea.png" alt="A decorative seal" class="grimoire-decoration grimoire-deco-5 d-none d-lg-block">
    <img src="https://suzakuchris.github.io/assets/fandaniel.png" alt="A decorative emblem" class="grimoire-decoration grimoire-deco-3 d-none d-lg-block">
    <img src="https://suzakuchris.github.io/assets/fandaniel.png" alt="A decorative sigil" class="grimoire-decoration grimoire-deco-4 d-none d-lg-block">

    <nav class="navbar navbar-dark mobile-nav d-lg-none fixed-top">
        <div class="container-fluid">
            <ul class="nav nav-pills d-flex w-100 justify-content-around">
                <li class="nav-item"><a class="nav-link" href="#feats-section">Feats</a></li>
                <li class="nav-item"><a class="nav-link" href="#skills-section">Skills</a></li>
                <li class="nav-item"><a class="nav-link" href="#attributes-section">Attributes</a></li>
                <li class="nav-item"><a class="nav-link" href="#vitals-section">Vitals</a></li>
                <li class="nav-item"><a class="nav-link" href="#powers-section">Powers</a></li>
            </ul>
        </div>
    </nav>


    <div class="container py-3 px-3 px-md-4 tome-container" style="z-index: 2; position: relative;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <header>
                <h1 class="tome-font display-4 text-white">
                    Anneliese Highwind
                </h1>
            </header>
            <div class="btn-group">
                <button class="btn btn-sm text-white" onclick="combat_mode();">
                    Combat
                </button>
                <button class="btn btn-sm text-white" style="border-left:1px solid white;" onclick='rp_mode();'>
                    Roleplay
                </button>
                <button class="btn btn-sm text-white" style="border-left:1px solid white;" data-bs-toggle="modal" data-bs-target="#inventoryModal">
                    Inventory & Tracker
                </button>
            </div>
        </div>

        <div class="bg-dark p-3 pb-1 shadow-sm rounded-lg mb-3" style="background:#626694 !important;">
            <div class="d-flex flex-column flex-md-row justify-content-between text-white gap-2 gap-md-0">
                <p><strong>Race:</strong> Dragonborn (Bozak Draconian)</p>
                <p><strong>Class:</strong> Sorcerer (Dragon Soul)</p>
                <p><strong>Theme:</strong> Windlord</p>
                <p><strong>Faculty:</strong> Anathema</p>
                <p><strong>Level:</strong> <span id="level"></span></p>
                <p><strong>Speed:</strong> 6 (Fly)</p>
            </div>
        </div>

        <div id="tome-pages-wrapper" class="row g-3 g-lg-4 position-relative">
            <div id="combat-page" class="col-12 col-lg-8">
                <div class="row">
                    <div class="col-12 col-lg-6">
                        <h3 id="vitals-section" class="tome-font h4 mb-2 text-white">Vital Stats</h3>
                        <div class="row g-2 mb-2">
                            <div class="col-6">
                                <div class="tome-item bg-dark-subtle p-2 shadow-sm rounded-lg d-flex flex-column justify-content-center align-items-center h-100" id="hp-container">
                                    <span class="text-lg tome-font text-white-50">HP</span>
                                    <div class="hp-input-container mt-2">
                                        <input type="number" id="current-hp" value="105">
                                        <span>/</span>
                                        <input type="number" id="max-hp" value="105" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="tome-item bg-dark-deep p-2 shadow-sm rounded-lg d-flex flex-column justify-content-center align-items-center h-100">
                                    <span class="text-lg tome-font text-white-50">Surges</span>
                                    <div class="surge-slider-container">
                                        <span class="fs-4 text-white fw-bold text-end mt-2" id="surge-value-display">9 / 9</span>
                                        <input type="range" id="surge-slider" min="0" max="9" value="9">
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="tome-item bg-dark-deep p-2 shadow-sm rounded-lg d-flex flex-column justify-content-center align-items-center h-100">
                                    <span class="text-lg tome-font text-white-50">Initiative</span>
                                    <span class="fs-4 text-white fw-bold mt-2" id="initiative-value">--</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="tome-item bg-dark-subtle p-2 shadow-sm rounded-lg d-flex flex-column justify-content-center align-items-center h-100">
                                    <span class="text-lg tome-font text-white-50">Passive Perception</span>
                                    <span class="fs-4 text-white fw-bold mt-2" id="passive-perception">--</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="tome-item bg-dark-subtle p-2 shadow-sm rounded-lg d-flex flex-column justify-content-center align-items-center h-100">
                                    <span class="text-lg tome-font text-white-50">Attack Roll</span>
                                    <div>
                                        <span class="fs-4 text-white fw-bold mt-2" id="attack-roll">--</span>
                                        <span class="text-white small mt-2">(MBA, Ensorc)</span>
                                    </div>
                                    <div>
                                        <span class="fs-4 text-white fw-bold mt-2" id="attack-implement-roll">--</span>
                                        <span class="text-white small mt-2">(+1 if vs ref)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="tome-item bg-dark-deep p-2 shadow-sm rounded-lg d-flex flex-column justify-content-center align-items-center h-100">
                                    <span class="text-lg tome-font text-white-50">Defenses</span>
                                    <span class="fs-5 text-white mt-2 text-center" id="defenses">--</span>
                                </div>
                            </div>
                            <div class="col-12">
                                <table id="bonus-dmg-table" class="table-dark table-striped table table-bordered text-center">
                                    <thead>
                                        <tr>
                                            <th colspan="2">Bonus Damage</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bonus-dmg-table-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <h3 id="feats-section" class="tome-font h4 mt-3 mb-2 text-white">Feats</h3>
                        <div id="feats-list" class="row g-2"></div>

                        <div id="feat-details-container" class="d-none">
                            <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
                                <h3 class="tome-font h4 mb-0 text-white">Feat Details</h3>
                                <button class="btn-close btn-close-white" onclick="document.getElementById('feat-details-container').classList.add('d-none');"></button>
                            </div>
                            <iframe id="feat-details-iframe" class="power-iframe" src="" frameborder="0"></iframe>
                        </div>
                        
                        <h3 id="attributes-section" class="tome-font h4 mb-2 text-white mt-3">Attributes</h3>
                        
                        <div id="attributes-list" class="row g-2"></div>
                    </div>
                    
                    <div class="col-12 col-lg-6">
                        <h4 class="tome-font h5 mb-2 mt-1">Power - <span class="text-white-50">At-Will</span></h4>
                        <div id="at-will-powers-list" class="power-grid"></div>

                        <div class="d-flex gap-2 mb-2 mt-3">
                            <h4 class="tome-font h5 mb-0 text-white-50">Encounter</h4>
                            <button id="clear-encounter-powers" class="btn btn-sm btn-clear-all ms-auto">Clear</button>
                        </div>
                        <div id="encounter-powers-list" class="power-grid"></div>

                        <div class="d-flex gap-2 mb-2 mt-3">
                            <h4 class="tome-font h5 mb-0 text-white-50">Daily</h4>
                            <button id="clear-daily-powers" class="btn btn-sm btn-clear-all ms-auto">Clear</button>
                        </div>
                        <div id="daily-powers-list" class="power-grid"></div>

                        <div id="power-details-container" class="d-none">
                            <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
                                <h3 class="tome-font h4 mb-0 text-white">Power Details</h3>
                                <button class="btn-close btn-close-white" onclick="document.getElementById('power-details-container').classList.add('d-none');"></button>
                            </div>
                            <iframe id="power-details-iframe" class="power-iframe" src="" frameborder="0"></iframe>
                        </div>

                        <hr class="mt-4"/>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
                            <h3 id="skills-section" class="tome-font h4 mb-0 text-white skill-collapsible-link" data-bs-toggle="collapse" data-bs-target="#skills-list-container" aria-expanded="false" aria-controls="skills-list-container">Skills</h3>
                        </div>
                        <div id="top-skills-preview"></div>
                        <div id="skills-list-container" class="collapse">
                            <div id="skills-list" class="row g-2"></div>
                        </div>

                        <div id="skill-details-container" class="d-none">
                            <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
                                <h3 class="tome-font h4 mb-0 text-white">Skill Details</h3>
                                <button class="btn-close btn-close-white" onclick="document.getElementById('skill-details-container').classList.add('d-none');"></button>
                            </div>
                            <iframe id="skill-details-iframe" class="power-iframe" src="" frameborder="0"></iframe>
                        </div>

                        <hr class="mt-4"/>
                        <h4 class="tome-font h5 mb-2 mt-2">Magic Items</span></h4>
                        <div id="magic-items-list" class="power-grid"></div>

                        <div id="mitem-details-container" class="d-none">
                            <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
                                <h3 class="tome-font h4 mb-0 text-white">Magic Items Details</h3>
                                <button class="btn-close btn-close-white" onclick="document.getElementById('mitem-details-container').classList.add('d-none');"></button>
                            </div>
                            <iframe id="mitem-details-iframe" class="mitem-iframe" src="" frameborder="0"></iframe>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-4">
                <h3 class="tome-font h4 mb-2 text-white">Character Portrait</h3>
                <div class="tome-item bg-dark-subtle p-3 shadow-sm rounded-lg mb-3 d-flex justify-content-center portrait-container" style="height:auto;">
                    <img src="https://suzakuchris.github.io/assets/abfd.png" alt="Character Portrait" class="w-100 rounded-lg">
                    <!-- <img src="file:///D:/suzakuchris.github.io/assets/abfd.png" alt="Character Portrait" class="w-100 rounded-lg"> -->
                </div>
                
                <h3 class="tome-font h4 mt-3 mb-2 text-white">Miscellaneous Features</h3>
                <div id="misc-features-list"></div>

                <div id="feat-details-container" class="d-none">
                    <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
                        <h3 class="tome-font h4 mb-0 text-white">Feat Details</h3>
                        <button class="btn-close btn-close-white" onclick="document.getElementById('feat-details-container').classList.add('d-none');"></button>
                    </div>
                    <iframe id="feat-details-iframe" class="power-iframe" src="" frameborder="0"></iframe>
                </div>

                <div id="misc-feature-details-container" class="d-none">
                    <h3 class="tome-font h4 mt-3 mb-2 text-white">Feature Details</h3>
                    <div id="misc-feature-content" class="tome-item p-3 shadow-sm rounded-lg bg-dark-subtle text-white-50"></div>
                </div>
            </div>

            <div id="roleplay-page" class="col-12 col-lg-8">
                <div class="row w-100">
                    <div class="col-12">
                        <div id="background-container">
                            <h3 class="tome-font h4 mb-2 text-white">Background</h3>
                            <div class="tome-item p-3 shadow-sm rounded-lg bg-dark-subtle text-white-50">
                                <i>"The true legacy of dragons is not in their scales or their fire, but in the legends they inspire. A thousand years of war, a sacred pact, a kingdom built on bones... all are but verses in the same grand, terrible epic."
                                </i>
                                <br/><br/>
                                <i>"He who seeks the heart of the dragon must first learn to fly on its breath. To face a wyrm, one must become a storm, a falling star, a fury that comes from the heavens."
                                </i>
                                <br/><br/>
                                Anne Highwind comes from a typical spellcrafter's family. Her parents were researchers who dedicated much of their careers to studying ancient dragon myths, along with many other legends. Surrounded by their work, Anne grew up quietly fascinated by these stories, especially those involving dragons—whether destructive beasts that razed civilizations or wise creatures who guided people and passed down what we now understand as magic.
                                <br/><br/>
                                In time, her parents moved on from their draconic studies, shifting their focus to other cultures and subjects. But the legends stayed with Anne. One tale in particular stood out of the story of a warrior who used draconic magic to rise into the sky. Whether the account was real or not was unclear, but the image stayed with her. As she studied further, she uncovered traces of a strange kind of magic that resembled what the old stories described. Though still limited in strength and duration, it allows her to lift off the ground and glide for brief moments.
                                <br/><br/>
                                Now, with her parents traveling the world, they've left her in charge of their earlier research and enrolled her in a school for spellcraft and espers. It's not just for education, it's a chance to continue their work, refine her abilities, and perhaps uncover something more. Anne doesn't seek fame or recognition; she studies to understand, and to see whether the old legend might hold a grain of truth.
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div id="background-container">
                            <h3 class="tome-font h4 mt-3 mb-2 text-white">Faculty - Anathema</h3>
                            <div class="tome-item p-3 shadow-sm rounded-lg bg-dark-subtle text-white-50">
                                Anathema, derived from the Greek word, anatithemi meaning "to offer up" in the olden days the word anathema is used by the pope to denounce an excommunication towards a person for being cursed. This faculty places its roots by that same logic, in order to defeat evil we must first learn of it. To defeat black magic and forbidden spellcrafts, we must dive deep into their psyche, we learn of their secrets so that we may keep the world in a balance. Anathema students are not expected to be heroes; lauded for their actions, paraded with their names strewn on signs on the street, instead they keep the silence, perhaps for their whole life, for the day that people hear of their actions, is the day they have failed their education.
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div id="background-container">
                            <h3 class="tome-font h4 mt-3 mb-2 text-white">Other Notes</h3>
                            <div class="tome-item p-3 shadow-sm rounded-lg bg-dark-subtle text-white-50">
                                She listens to symphonic rock.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="inventoryModal" tabindex="-1" aria-labelledby="inventoryModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark-subtle border border-secondary">
          <div class="modal-header border-bottom border-secondary">
            <h5 class="modal-title tome-font text-white" id="inventoryModalLabel">Inventory & Session Tracker</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-4">
              <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory-pane" type="button" role="tab" aria-controls="inventory-pane" aria-selected="true">Inventory</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes-pane" type="button" role="tab" aria-controls="notes-pane" aria-selected="false">Session Tracker</button>
                </li>
              </ul>
              <div class="tab-content pt-3" id="myTabContent">
                <div class="tab-pane fade show active" id="inventory-pane" role="tabpanel" aria-labelledby="inventory-tab">
                    <h4 class="tome-font h5 mb-2 text-white">Inventory</h4>
                    <textarea id="inventory-area" class="form-control bg-dark-deep text-white border-secondary mb-3"></textarea>
                </div>
                <div class="tab-pane fade" id="notes-pane" role="tabpanel" aria-labelledby="notes-tab">
                    <h4 class="tome-font h5 mb-2 text-white">Session Notes</h4>
                    <textarea id="notes-area" class="form-control bg-dark-deep text-white border-secondary mb-3"></textarea>
                </div>
              </div>
              <div class="text-end">
                <button id="save-data-btn" class="btn btn-sm btn-clear-all">Save All</button>
              </div>
          </div>
        </div>
      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        // =========================================================================
        //  FIREBASE CONFIGURATION
        // =========================================================================
        const firebaseConfig = {
            // Replace with the config from your Firebase project.
            apiKey: "AIzaSyAZmkytKusbdoDt0g6GOWNYlsXh5TkQI8M",
            authDomain: "rise-character-sheet.firebaseapp.com",
            projectId: "rise-character-sheet",
            storageBucket: "rise-character-sheet.firebasestorage.app",
            messagingSenderId: "633547066454",
            appId: "1:633547066454:web:63dfbb6a724308b1fbbff7",
            measurementId: "G-M80TGFZC8P"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // The name of the single document to save to
        const characterDocId = 'lilianna-highwind';

        // =========================================================================
        //  FIREBASE DATA FUNCTIONS
        // =========================================================================
        function saveData() {
            // Get the current content from both text areas
            const dataToSave = {
                inventory: document.getElementById('inventory-area').value,
                notes: document.getElementById('notes-area').value,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection("character_data").doc(characterDocId).set(dataToSave)
            .then(() => {
                alert("Inventory and notes saved successfully!");
            })
            .catch((error) => {
                console.error("Error saving data:", error);
                alert("Error saving data. Check the console for details.");
            });
        }

        function loadData() {
            db.collection("character_data").doc(characterDocId).get()
              .then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    document.getElementById('inventory-area').value = data.inventory || "";
                    document.getElementById('notes-area').value = data.notes || "";
                    console.log("Data loaded successfully!");
                } else {
                    console.log("No data found, starting with a blank page.");
                    document.getElementById('inventory-area').value = "";
                    document.getElementById('notes-area').value = "";
                }
              })
              .catch((error) => {
                console.error("Error loading data:", error);
              });
        }
        
        // Attach event listeners to the modal and save button
        const inventoryModal = document.getElementById('inventoryModal');
        inventoryModal.addEventListener('shown.bs.modal', loadData);
        document.getElementById('save-data-btn').addEventListener('click', saveData);

        // =========================================================================
        //  VIEW TOGGLE FUNCTIONS
        // =========================================================================
        function combat_mode() {
            document.getElementById('tome-pages-wrapper').classList.remove('show-roleplay');
        }

        function rp_mode() {
            document.getElementById('tome-pages-wrapper').classList.add('show-roleplay');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // =========================================================================
            //  EDITABLE DATA: Modify these objects to update your character sheet
            // =========================================================================
            const level = 4;
            const weaponProf = 3;
            const otherBonus = 1+1; //expertise and magic weapon
            const levelBonus = Math.floor(level/2);
            const ACBonus = 2+1+1;//veterans armor (cloth) and unarmored agility and rhythm dagger
            const REFBonus = 1+1; //safewing amulet
            const FORTBonus = 0+1; //safewing amulet
            const WILLBonus = 2+1; //safewing amulet
            const HSUsed = 0;

            const attributes = {
                "STR": 18, "CON": 11, "DEX": 12, "INT": 10, "WIS": 8, "CHA": 20
            };

            const skills = {
                "Acrobatics": { id: 'skill1', baseAttribute: "DEX", trained: false, otherBonus: 0 },
                "Arcana": { id: 'skill2', baseAttribute: "INT", trained: true, otherBonus: 0 },
                "Athletics": { id: 'skill27', baseAttribute: "STR", trained: true, otherBonus: 3 },
                "Bluff": { id: 'skill3', baseAttribute: "CHA", trained: true, otherBonus: 0 },
                "Diplomacy": { id: 'skill6', baseAttribute: "CHA", trained: false, otherBonus: 0 },
                "Dungeoneering": { id: 'skill7', baseAttribute: "WIS", trained: false, otherBonus: 0 },
                "Endurance": { id: 'skill8', baseAttribute: "CON", trained: false, otherBonus: 2 },
                "Heal": { id: 'skill9', baseAttribute: "WIS", trained: false, otherBonus: 0 },
                "History": { id: 'skill11', baseAttribute: "INT", trained: false, otherBonus: 2 },
                "Insight": { id: 'skill13', baseAttribute: "WIS", trained: false, otherBonus: 0 },
                "Intimidate": { id: 'skill14', baseAttribute: "CHA", trained: true, otherBonus: 2 },
                "Nature": { id: 'skill16', baseAttribute: "WIS", trained: false, otherBonus: 0 },
                "Perception": { id: 'skill17', baseAttribute: "WIS", trained: false, otherBonus: 2 },
                "Religion": { id: 'skill18', baseAttribute: "INT", trained: false, otherBonus: 0 },
                "Stealth": { id: 'skill20', baseAttribute: "DEX", trained: false, otherBonus: 0 },
                "Streetwise": { id: 'skill21', baseAttribute: "CHA", trained: false, otherBonus: 0 },
                "Thievery": { id: 'skill23', baseAttribute: "DEX", trained: false, otherBonus: 0 }
            };

            const powersToDisplay = [
                { id: 'power13425', name: 'Ensorcelled Blade', type: 'At-Will' },
                { id: 'power3701', name: 'Burning Spray', type: 'At-Will' },

                { id: 'power12577', name: 'Dragonfear', type: 'Encounter' },
                { id: 'power3171', name: 'Tearing Claws', type: 'Encounter' },
                { id: 'power16113', name: 'Wind Fury Assault', type: 'Encounter' },
                { id: 'power3718', name: 'Explosive Pyre', type: 'Encounter' },
                { id: 'power3053', name: 'Sorcerous Sirocco', type: 'Encounter' },

                { id: 'power5264', name: 'Dazzling Ray', type: 'Daily' }
            ];

            const featsToDisplay = [
                { id: 'feat2785', name: 'Versatile Expertise' },
                { id: 'feat2626', name: 'Unarmored Agility' },
                { id: 'implement3707', name: 'Superior Implement Training (Inc. Dagger)' },
                { id: 'feat27', name: 'Long Jumper' }
            ];

            const magicItems = [
                { id: 'armor2986', name: 'Veterans Armor (+1)' },
                { id: 'item842', name: 'Catstep Boots' },
                { id: 'weapon2188', name: 'Rhythm Dagger (+1)' },
                { id: 'weapon1306', name: 'Flaming Dagger (+1)' },
                { id: 'weapon1689', name: 'Khyber Shard of the Fiery Depth' },
                { id: 'item2378', name: 'Safewing Amulet (+1)' },
                { id: 'item639', name: 'Belt of Endurance' },
            ];

            const bonusDamageReminder = [
                { plus: 4, notes: 'Strength (Dragon Soul, Arcane only)' },
                { plus: 2, notes: 'Incendiary Dagger (Fire only)' },
                { plus: 1, notes: 'Kyberis Fire Shard (Fire only)' },
                { plus: 1, notes: 'Bozak Arcane Might (Arcane only)' },
            ];

            const miscFeaturesToDisplay = [
                { name: 'Dragonborn (Bozak) Traits', content: `
                    Speed: 6 squares.
                    Vision: Normal

                    Languages: Common, Draconic
                    Skill Bonuses: +2 History, +2 Intimidate.

                    Instinctive Flight:Although your wings are neither large enough nor strong enough to sustain flight for long, your battleground mobility is still quite extraordinary.
                    Benefits: You gain a flight speed of 6 squares (altitude limit 1). You cannot use this fly speed if you are carrying more than a normal load. You must land at the end of your turn. This benefit replaces Draconic Heritage.

                    Arcane Blood:The essence of your draconic forebears surges through your veins. Born to a legacy of arcane might, you have learned to augment your spells with this gift.
                    Benefits: You gain a +1 racial bonus to the damage rolls of your arcane attack powers. This bonus increases to +2 at 11th level and +3 at 21st level. This benefit replaces Dragonborn Fury.
                ` },
                { name: 'Dragon Magic', content: `
                    Draconic Power: You gain a bonus to the damage rolls of arcane powers equal to your Strength modifier (+4). The bonus increases to your Strength modifier +2 at 11th level and your Strength modifier +4 at 21st level.

                    Draconic Resilience: While you are not wearing heavy armor, you can use your Strength modifier in place of your Dexterity or Intelligence modifier to determine your AC.

                    Dragon Soul: Choose a damage type: (Fire). You gain resist 5 to that damage type. The resistance increases to 10 at 11th level and 15 at 21st level. Your arcane powers ignore any target's resistance to that damage type up to the value of your resistance.
                ` },
                { name: 'Scales of the Dragon', content: `
                    The first time you become bloodied during an encounter, you gain a +2 bonus to AC until the end of the encounter.
                ` },
                { name: 'Dragonborn Racial Power', content: `
                    Dragonfear: You are naturally intimidating at the best of times, and when passions strike, you are positively terrifying. You gain the dragonfear racial power.
                ` },
                { name: 'Windlord', content: `
                    Your origin becomes elemental. For the purpose of effects that relate to creature origin, you are considered to be an elemental. Add Primordial to the languages you can read, write, and speak. You gain a +2 power bonus to Athletics checks and Perception checks.
                ` },
                { name: 'Versatile Aptitude (Background)', content: `
                    Choose one feat with “Expertise” in its name or
                    the Master at Arms feat in which you can meet
                    the requirements. You gain that feat.
                    (Versatile Expertise)
                ` },
            ];

            // =========================================================================
            //  END OF EDITABLE DATA
            // =========================================================================

            const baseHP = 12;
            const hitPointsPerLevel = 5;
            const totalHP = baseHP + ((level-1)*hitPointsPerLevel) + attributes['CON'];
            const HSPerDay = 6 + Math.floor((attributes['CON']-10)/2);
            const initiative = Math.floor((attributes['DEX']-10)/2);

            const attackValue = ((attributes['CHA']-10)/2) + weaponProf + otherBonus + levelBonus;
            const attackValueImplement = ((attributes['CHA']-10)/2) + otherBonus + levelBonus;

            const baseDefense = 10;
            const ACDefense = levelBonus+baseDefense+ACBonus+Math.floor((attributes['STR']-10)/2)+Math.floor((attributes['DEX']-10)/2);
            const REFDefense = levelBonus+baseDefense+REFBonus+Math.floor((attributes['DEX']-10)/2);
            const FORTDefense = levelBonus+baseDefense+FORTBonus+Math.floor((attributes['STR']-10)/2);
            const WILLDefense = levelBonus+baseDefense+WILLBonus+Math.floor((attributes['CHA']-10)/2);

            const attributesList = document.getElementById('attributes-list');
            const skillsList = document.getElementById('skills-list');
            const atWillPowersList = document.getElementById('at-will-powers-list');
            const encounterPowersList = document.getElementById('encounter-powers-list');
            const dailyPowersList = document.getElementById('daily-powers-list');
            const featsList = document.getElementById('feats-list');
            const magicItemsList = document.getElementById('magic-items-list');
            const miscFeaturesList = document.getElementById('misc-features-list');
            const clearEncounterButton = document.getElementById('clear-encounter-powers');
            const clearDailyButton = document.getElementById('clear-daily-powers');
            const powerIframe = document.getElementById('power-details-iframe');
            const mitemIframe = document.getElementById('mitem-details-iframe');
            const skillIframe = document.getElementById('skill-details-iframe');
            const featIframe = document.getElementById('feat-details-iframe');
            const passivePerceptionElement = document.getElementById('passive-perception');
            const currentHpInput = document.getElementById('current-hp');
            const maxHpInput = document.getElementById('max-hp');
            const hpContainer = document.getElementById('hp-container');
            const surgeSlider = document.getElementById('surge-slider');
            const surgeDisplay = document.getElementById('surge-value-display');
            const skillDetailsContainer = document.getElementById('skill-details-container');
            const powerDetailsContainer = document.getElementById('power-details-container');
            const mitemDetailsContainer = document.getElementById('mitem-details-container');
            const featDetailsContainer = document.getElementById('feat-details-container');
            const miscFeatureDetailsContainer = document.getElementById('misc-feature-details-container');
            const miscFeatureContent = document.getElementById('misc-feature-content');
            const topSkillsPreview = document.getElementById('top-skills-preview');


            // Function to calculate the attribute modifier
            function getModifier(score) {
                return Math.floor((score - 10) / 2);
            }

            // Function to generate the list items from a JSON object
            function generateListItems(list, data, isTomeFont = false, perRow = 1, isSkill = false, isPreview = false) {
                list.innerHTML = '';
                const entries = Object.entries(data);
                const skillValues = {};

                if (isSkill) {
                     for (const [key, value] of Object.entries(skills)) {
                        const attributeValue = attributes[value.baseAttribute];
                        const attributeModifier = getModifier(attributeValue);
                        const trainedBonus = value.trained ? 5 : 0;
                        const finalValue = attributeModifier + trainedBonus + value.otherBonus + levelBonus;
                        skillValues[key] = finalValue;
                    }
                    entries.sort((a, b) => skillValues[b[0]] - skillValues[a[0]]);
                }
                
                let itemsToDisplay = isPreview ? entries.slice(0, 3) : entries;

                for (let i = 0; i < itemsToDisplay.length; i += perRow) {
                    const row = document.createElement('div');
                    row.className = 'row g-2 mb-2';

                    for (let j = 0; j < perRow && i + j < itemsToDisplay.length; j++) {
                        const [key, value] = itemsToDisplay[i + j];
                        const col = document.createElement('div');
                        col.className = 'col';

                        const item = document.createElement('div');
                        item.className = 'tome-item p-2 shadow-sm rounded-lg d-flex justify-content-between align-items-center h-100';
                        const isOdd = (i + j) % 2 !== 0;
                        item.classList.add(isOdd ? 'bg-dark-deep' : 'bg-dark-subtle');
                        
                        const keySpan = document.createElement('span');
                        
                        if (isSkill) {
                            keySpan.className = 'text-lg text-white-50 skill-name-link';
                            keySpan.textContent = key;
                            keySpan.onclick = () => {
                                skillDetailsContainer.classList.remove('d-none');
                                skillIframe.src = `https://iws.mx/dnd/?view=${value.id}`;
                            };
                        } else {
                            keySpan.className = `text-lg text-white-50 ${isTomeFont ? 'tome-font' : ''}`;
                            keySpan.textContent = key;
                        }

                        const valueSpan = document.createElement('span');
                        valueSpan.className = 'fs-4 text-white fw-bold text-end';
                        
                        if (isSkill) {
                            valueSpan.textContent = `+${skillValues[key]}`;
                        } else {
                            valueSpan.textContent = value;
                        }

                        item.appendChild(keySpan);
                        item.appendChild(valueSpan);
                        col.appendChild(item);
                        row.appendChild(col);
                    }
                    list.appendChild(row);
                }
            }

            
            // Function to generate and render the list of powers
            function generatePowersList(listElement, powers, showCheckbox = false) {
                // Sort powers alphabetically by name
                powers.sort((a, b) => a.name.localeCompare(b.name));
                
                listElement.innerHTML = '';
                powers.forEach((power, index) => {
                    const item = document.createElement('div');
                    item.className = 'tome-item p-2 shadow-sm rounded-lg mb-2 power-item-container';
                    const isOdd = index % 2 !== 0;
                    item.classList.add(isOdd ? 'bg-dark-deep' : 'bg-dark-subtle');
                    item.setAttribute('data-power-type', power.type);

                    const nameAndType = document.createElement('div');
                    nameAndType.className = 'd-flex align-items-center flex-grow-1';
                    nameAndType.onclick = () => {
                        powerDetailsContainer.classList.remove('d-none');
                        powerIframe.src = `https://iws.mx/dnd/?view=${power.id}`;
                    };

                    const powerName = document.createElement('span');
                    powerName.className = 'power-name me-2 power-name-link';
                    powerName.textContent = power.name;

                    nameAndType.appendChild(powerName);
                    
                    item.appendChild(nameAndType);

                    if (showCheckbox) {
                        const checkbox = document.createElement('div');
                        checkbox.className = 'form-check form-switch ms-3';
                        const input = document.createElement('input');
                        input.className = 'form-check-input';
                        input.type = 'checkbox';
                        checkbox.appendChild(input);
                        item.appendChild(checkbox);
                    }

                    listElement.appendChild(item);
                });
            }

            // Function to generate and render the list of feats
            function generateFeatsList() {
                featsToDisplay.sort((a, b) => a.name.localeCompare(b.name));
                
                featsList.innerHTML = '';
                const entries = featsToDisplay;

                for (let i = 0; i < entries.length; i += 2) {
                    const row = document.createElement('div');
                    row.className = 'row g-2 mb-2';

                    for (let j = 0; j < 2 && i + j < entries.length; j++) {
                        const feat = entries[i + j];
                        const col = document.createElement('div');
                        col.className = 'col';

                        const item = document.createElement('div');
                        item.className = 'tome-item p-2 shadow-sm rounded-lg feat-item-container';
                        const isOdd = (i + j) % 2 !== 0;
                        item.classList.add(isOdd ? 'bg-dark-deep' : 'bg-dark-subtle');

                        const featName = document.createElement('span');
                        featName.className = 'feat-name-link';
                        featName.textContent = feat.name;
                        featName.onclick = () => {
                            featDetailsContainer.classList.remove('d-none');
                            featIframe.src = `https://iws.mx/dnd/?view=${feat.id}`;
                        };
                        
                        item.appendChild(featName);
                        col.appendChild(item);
                        row.appendChild(col);
                    }
                    featsList.appendChild(row);
                }
            }

            function generateMagicItemList(){
                magicItems.sort((a, b) => a.name.localeCompare(b.name));
                magicItemsList.innerHTML = '';
                magicItems.forEach((feature, index) => {
                    const item = document.createElement('div');
                    item.className = 'tome-item p-2 shadow-sm rounded-lg mb-2 feat-item-container';
                    const isOdd = index % 2 !== 0;
                    item.classList.add(isOdd ? 'bg-dark-deep' : 'bg-dark-subtle');

                    const magicItemName = document.createElement('span');
                    magicItemName.className = 'misc-feature-link';
                    magicItemName.textContent = feature.name;

                    magicItemName.onclick = () => {
                        mitemDetailsContainer.classList.remove('d-none');
                        mitemIframe.src = `https://iws.mx/dnd/?view=${feature.id}`;
                    };
                    
                    item.appendChild(magicItemName);
                    magicItemsList.appendChild(item);
                });
            }

            // Function to generate and render the list of miscellaneous features
            function generateMiscFeaturesList() {
                miscFeaturesToDisplay.sort((a, b) => a.name.localeCompare(b.name));
                
                miscFeaturesList.innerHTML = '';
                miscFeaturesToDisplay.forEach((feature, index) => {
                    const item = document.createElement('div');
                    item.className = 'tome-item p-2 shadow-sm rounded-lg mb-2 feat-item-container';
                    const isOdd = index % 2 !== 0;
                    item.classList.add(isOdd ? 'bg-dark-deep' : 'bg-dark-subtle');

                    const featureName = document.createElement('span');
                    featureName.className = 'misc-feature-link';
                    featureName.textContent = feature.name;
                    featureName.onclick = () => {
                        miscFeatureDetailsContainer.classList.remove('d-none');
                        miscFeatureContent.innerHTML = `<p class="text-white-50">${feature.content}</p>`;
                    };
                    
                    item.appendChild(featureName);
                    miscFeaturesList.appendChild(item);
                });
            }

            function generateBonusReminderList(){
                var table = document.getElementById("bonus-dmg-table-body")

                var row = '';
                bonusDamageReminder.forEach((a, b) => {
                    row += `
                        <tr>
                            <td>${a.plus}</td>
                            <td>${a.notes}</td>    
                        </tr>
                    `;
                });

                table.setHTMLUnsafe(row);
            }

            // Clear powers functionality for Encounter and Daily
            clearEncounterButton.addEventListener('click', () => {
                const powers = encounterPowersList.querySelectorAll('input[type="checkbox"]');
                powers.forEach(cb => cb.checked = false);
            });
             clearDailyButton.addEventListener('click', () => {
                const powers = dailyPowersList.querySelectorAll('input[type="checkbox"]');
                powers.forEach(cb => cb.checked = false);
            });

            // HP Tracking Logic
            function updateHpDisplay() {
                const currentHp = parseInt(currentHpInput.value, 10);
                const maxHp = parseInt(maxHpInput.value, 10);

                if (currentHp <= maxHp / 2) {
                    hpContainer.classList.add('bloodied-effect');
                } else {
                    hpContainer.classList.remove('bloodied-effect');
                }
            }
            currentHpInput.addEventListener('input', updateHpDisplay);
            maxHpInput.addEventListener('input', updateHpDisplay);

            // Healing Surge Slider Logic
            surgeSlider.addEventListener('input', () => {
                const currentSurges = surgeSlider.value;
                const maxSurges = surgeSlider.max;
                surgeDisplay.textContent = `${currentSurges} / ${maxSurges}`;
            });
            
            // Skills preview toggle
            const skillsToggle = document.querySelector('.skill-collapsible-link');
            const skillsListCollapse = document.getElementById('skills-list-container');
            
            skillsToggle.addEventListener('click', () => {
                const isExpanded = skillsListCollapse.classList.contains('show');
                topSkillsPreview.classList.toggle('d-none', isExpanded);
                skillsToggle.classList.toggle('collapsed', isExpanded);
            });


            // Calculate Passive Perception
            const perceptionSkill = skills.Perception;
            const perceptionAttribute = attributes[perceptionSkill.baseAttribute];
            const perceptionModifier = levelBonus+getModifier(perceptionAttribute) + (perceptionSkill.trained ? 5 : 0) + perceptionSkill.otherBonus;
            passivePerceptionElement.textContent = perceptionModifier + 10;


            // Set the default power to display on load
            if (powersToDisplay.length > 0) {
                // powerIframe.src = `https://iws.mx/dnd/?view=${powersToDisplay[0].id}`;
            }

            // Group powers by type
            const atWillPowers = powersToDisplay.filter(p => p.type === 'At-Will');
            const encounterPowers = powersToDisplay.filter(p => p.type === 'Encounter');
            const dailyPowers = powersToDisplay.filter(p => p.type === 'Daily');

            // Generate the lists on page load
            generateListItems(attributesList, attributes, true, 3, false);
            generateListItems(skillsList, skills, false, 3, true);
            generateListItems(topSkillsPreview, skills, false, 3, true, true);
            generatePowersList(atWillPowersList, atWillPowers, false);
            generatePowersList(encounterPowersList, encounterPowers, true);
            generatePowersList(dailyPowersList, dailyPowers, true);
            generateFeatsList();
            generateMiscFeaturesList();
            generateMagicItemList();
            generateBonusReminderList();

            $("#level").html(level);
            $("#current-hp").val(totalHP);
            $("#max-hp").val(totalHP);
            $("#initiative-value").html("+"+initiative);

            var currentHS = HSPerDay-HSUsed;
            $("#surge-value-display").html(currentHS+" / "+HSPerDay);
            $("#surge-slider").attr("max", HSPerDay);
            $("#surge-slider").attr("value", currentHS);
            $("#attack-roll").html("+"+attackValue);
            $("#attack-implement-roll").html("+"+attackValueImplement);
            $("#defenses").html("AC"+ACDefense+" R"+REFDefense+" F"+FORTDefense+" W"+WILLDefense);
        });
    </script>
</body>
</html>